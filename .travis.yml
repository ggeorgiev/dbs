language: cpp

os:
  - osx

osx_image: xcode7.3

env:
    global:
      - secure: "J7u1rzOwK01iL/JUticsZPlPiGEi2D+bbbmKgC329sDUNqkev8eA5D+nP549zk90IhfPSxc9XzAwPJJ1dBSIJ8toi0rL5NXvpkE+vW2x3Vwb042GIFGifv5Te9q9lNhYIpEIvOrxyFQK8JEEJKdYjTvnJ/oTxWUY4jo5rvS+O4NdOzlFyCCwTv+A2Dv0vOIduwquNznNsUPBRminHxNaW23DRdS2RirPJxPAVJW2iibchPt+dusfheF1KcIK6/ax4dEi3NAyxXd+HNqlyQCOZG3yxkfiARAOD/PJp9VySMc5AvnjBdUQQgGw75qrQ+zq8puiQMUxEMN2EtK5Fq0VB3bdfvTp/nYUr5auvI9G4F+ZaRipsHdXgVh1LbgGUTFXtL9rShYukFvwHqQiCWV0kFC8FWOX3W+Cqay8XzfjxQTba70uxkZRMIGFG6Jt7NgscaGyVqjmh+2JH6mMtQwp2dJfaemFcrN1WaFgGZ1wwlLsKwZxaRl7QF24bnOZQ3Gfx+eC9GuFZ/TIjenziLNrQAJm10tlP0bYQRHGy5NKamiLDaEQ88mle874DbjLA1BJZNReDjPyDGTZXlVdYnSGYsFJrDnoKcaQa2U9/M7AGB4E8TNR1uPm7wjxsOeNTT0PyVXp3kbRagQMg4WWVSRZvNPYlddx3SQ0u4+Nsr6uw1M="

git:
    submodules: false
    depth: 3

addons:
    apt:
        sources:
          - george-edison55-precise-backports # cmake 3.2.3 / doxygen 1.8.3
        packages:
          - cmake
          - cmake-data

    coverity_scan:
        project:
            name: "ggeorgiev/dbs"
            description: "Build submitted via Travis CI"
            notification_email: george.georgiev.sf@gmail.com
            build_command_prepend: cov-configure --comptype clangcxx --compiler clang++ --template
            build_command: "./self-build.sh"
            branch_pattern: coverity_scan

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo add-apt-repository ppa:ubuntu-toolchain-r/test -y ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get update -q ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get install gcc-4.8 g++-4.8 -y ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.8 60 --slave /usr/bin/g++ g++ /usr/bin/g++-4.8 ; fi

  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install lcov ; fi

  - ./prepare.sh

install:
  - gem install coveralls-lcov
  - ./build.sh

after_success:
  - lcov --directory build --base-directory src --capture --no-external --output-file coverage.info | grep Processing # capture coverage info
  - lcov --list coverage.info # debug before upload
  - coveralls-lcov coverage.info # uploads to coveralls

script:
    ./self-build.sh

cache:
    directories:
      - iwyu
      - boost
      - fmt
      - gtest
      - rocksdb
      - spdlog

